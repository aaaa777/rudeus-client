# はじめに

このドキュメントは、IT資産管理Rudeusクライアント の概要と使い方について説明します。

---

# 概要

Rudeusクライアントは、IT資産管理システムErisのクライアントアプリケーションです。

インストールしたデバイスを管理することができます。

管理サーバErisと通信し、デバイスの登録、情報の更新、アクセスログの取得などの機能を提供します。

下図は、RudeusクライアントがErisと通信する際のイメージです。

![rudeus-ab](/images/rudeus-ab.png)

このドキュメント内では上の常駐プログラムをクライアントまたはRudeusと呼びます。

---

# 運用方法

デバイスにRudeusクライアントをインストールすれば、自動で管理サーバErisと同期しデバイスが管理下に置かれます。

インストール時点でそれぞれのデバイスにアクセストークンとデバイスID(UUID)が発行され、それを使ってデバイスの情報を更新します。

アクセストークンもデバイスIDも変更不可能なので、再インストールした場合には新しいデバイスとして登録されることに注意してください。

インストール方法については[こちら](installation.md)を参照してください。

## 管理サーバでの操作方法

管理サーバErisには、デバイスの一覧表示、デバイスの手動登録、学生の一覧表示、プッシュ通知の配信などの機能があります。

### デバイス一覧/詳細の確認

左メニューからデバイス一覧を選択すると、以下の画面になります。

![eris-devices](/images/eris-devices.png)

更にデバイスID部分をクリックすると、デバイスの詳細情報を確認できます。

![eris-device-detail](/images/eris-device-detail.png)

この画面ではデバイス詳細情報のほか、アクセスログやアップデート情報を確認できます。

---

### デバイスの手動登録

デバイス新規登録画面からデバイスを手動で登録することができます。

これはクライアントアプリがインストールされていないデバイスに対して行う操作です。

Rudeusクライアントをインストールしたデバイスにはこの操作は不要です。

![eris-device-creation](/images/eris-device-creation.png)

---

### デバイスと学生紐づけ

通常、アプリがインストールされているとユーザにログインを促す画面が定期的に表示されます。

しかし学生の操作に関わらず、学生とデバイスの紐づけを操作することもできます。

これはデバイス > 学生手動紐づけ画面、学生紐づけ解除画面から行います。

![eris-device-stu1](/images/eris-device-stu1.png)

![eris-device-stu2](/images/eris-device-stu2.png)

---

### 学生一覧

学生がログインできるアカウントは学生一覧画面に登録されている必要があります。

CSVファイルを使って一括登録するか、手動で登録してください。

![eris-students](/images/eris-students.png)

---

### プッシュ配信

学生のデバイスは定期的に管理サーバと通信します。

そのタイミングで任意のメッセージや予定を配信することができます。

また新規ボタンからプッシュ通知を作成し、配信対象の学生も指定できます。

![eris-push](/images/eris-push.png)

---

### アップデート

実行ファイルをアップデートするのに使います。

RudeusクライアントはRudeus.Application、Rudeus.Command、Rudeus.Launcherの3つのアプリケーションで構成されています。

それぞれApplication（タスクトレイ）とCommand（バックグラウンド）をアップデートすることができます。

![eris-update-app](/images/eris-update-app.png)

この画面に実行ファイル等をZipでアップロードするとデバイスの定期通信時にアップデートが行われます。

手動でZipファイルにまとめると漏れが発生する可能性があるため自動化をお勧めします。

Github Actionsを利用して自動化するサンプルは`.github/workflows/dotnet-desktop.yml`を参照してください。

#### note: ApplicationとCommandの違い

Applicationはタスクトレイに常駐するプログラムです。

アンインストール時にApplicationだけ削除することでユーザがRudeusクライアント全体を削除したと思い込ませるために分割しましたが、その必要性がよく分からなくなったため放置されています。

Commandはデバイス情報の更新を行うためのコマンドラインツールで、イベントで発火する設計のため常駐はしません。

インストール時にイベントスケジューラが登録され、定期的に実行されます。

---

## その他情報

全デバイスのネットワークインターフェース情報や、インストール済みアプリケーションの一覧を表示できます。

個別のデバイス情報はデバイス詳細画面から確認できます。

![eris-nwif](/images/eris-nwif.png)

---

# 動作の流れ

Rudeusクライアントは、REST APIを使用して管理サーバーと通信します。

このセクションでは操作に使用するREST APIについて説明します。

## デバイスの登録
![register](/images/flow-register.png)

デバイスを登録するためには、`/api/device_initialize`を使用します。

このAPIは、デバイスを初期化し、アクセストークンを発行します。

初期化後には、デバイスの情報を更新するためのAPIを使用します。

`/api/device_initialize`を除くすべてのAPIは、初期化後に発行されるアクセストークンを使用して認証されます。

---

## デバイス情報の更新
![update](/images/flow-reg-update.png)

デバイス情報を更新するためには、`/api/device_update`を使用します。

このAPIは、デバイスの情報を最新の状態にします。

---

# その他のドキュメント

Rudeusクライアントのクラス定義については[こちら](/api/Rudeus.html)(APIタブ)

管理サーバErisについては、[こちら](https://win.nomiss.net/admin)でデモとドキュメントをご覧いただけます。(ユーザ/パスワードはadmin/adminです。)

管理サーバのテーブル定義は[こちら](https://win.nomiss.net/admin/docs/db/eris)

APIの詳細なリファレンスは[こちら](https://win.nomiss.net/admin/docs/api/eris)

開発時のメモは[こちら](https://scrapbox.io/zemi-windows-project/)
